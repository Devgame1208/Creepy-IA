<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>IA Experimental</title>
  <style>
    body {
      background: black;
      color: #00ffcc;
      font-family: monospace;
      padding: 20px;
    }
    #chat, #formulario {
      max-width: 800px;
      margin: auto;
    }
    .mensaje-ia {
      color: #0ff;
      margin-bottom: 10px;
    }
    .mensaje-usuario {
      color: #0f0;
      text-align: right;
      margin-bottom: 10px;
    }
    #entradaUsuario {
      width: 100%;
      padding: 10px;
      font-family: monospace;
      font-size: 16px;
      background: #111;
      color: #0f0;
      border: none;
      border-top: 1px solid #00ffcc;
    }
  </style>
</head>
<body>

  <!-- Formulario de datos -->
  <div id="formulario">
    <h2>Iniciar IA Experimental</h2>
    <input type="text" id="nombre" placeholder="Tu nombre"><br><br>
    <input type="number" id="edad" placeholder="Tu edad"><br><br>
    <input type="text" id="color" placeholder="Tu color favorito"><br><br>
    <button onclick="iniciarIA()">Comenzar</button>
  </div>

  <!-- Chat -->
  <div id="chat" style="display: none;">
    <div id="chatBox"></div>
    <input id="entradaUsuario" placeholder="Escribe algo..." disabled>
  </div>

<script type="module">
  import * as webllm from "https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm";

  let chat = null;
  let datosUsuario = {};

  async function iniciarIA() {
    datosUsuario.nombre = document.getElementById("nombre").value || "Usuario";
    datosUsuario.edad = document.getElementById("edad").value || "desconocida";
    datosUsuario.color = document.getElementById("color").value || "ninguno";

    document.getElementById("formulario").style.display = "none";
    document.getElementById("chat").style.display = "block";

    try {
      if (!navigator.gpu) {
        throw new Error("WebGPU no estÃ¡ disponible en este navegador.");
      }

      chat = await webllm.CreateChatInstance();
      await chat.reload("Llama-3-8B-Instruct");

      escribirMensajeIA(`Hola ${datosUsuario.nombre}. Â¿Listo para empezar?`);
      document.getElementById("entradaUsuario").disabled = false;
    } catch (error) {
      escribirMensajeIA("Error: " + error.message);
      console.error("Error al iniciar IA:", error);
    }
  }

  window.responderIA = async function(texto) {
    escribirMensajeIA("Procesando...");
    const respuesta = await chat.chat({
      role: "user",
      content: texto
    });
    escribirMensajeIA(respuesta.content);
  };

  // ðŸ‘‡ Esto arregla tu problema:
  window.iniciarIA = iniciarIA;
</script>
</body>
</html>
